<app-header [isLoggedIn]="isLoggedIn" [currentUser]="user"></app-header>

<div class="profile-container">
  <div class="profile-card">
    <div class="profile-header">
      <h1>👤 Profilim</h1>
      <div class="user-info">
        <h2>{{ user?.name }}</h2>
        <p>{{ user?.email }} | {{ user?.city }}</p>
      </div>
      <button class="refresh-btn" (click)="loadUserData()" title="Yenile" [disabled]="isLoading">
        <span *ngIf="!isLoading">🔄 Yenile</span>
        <span *ngIf="isLoading">⏳ Yenileniyor...</span>
      </button>
      <button class="debug-btn" (click)="debugUserInfo()" title="Debug">
        🐛 Debug
      </button>
    </div>

    <div class="profile-content">
      <!-- Pet Profilleri Bölümü -->
      <div class="section">
        <div class="section-header">
          <h3>🐕 Pet Profillerim</h3>
          <button class="create-btn" (click)="createPetProfile()">
            + Yeni Pet Profili
          </button>
        </div>
        
        <div class="items-grid" *ngIf="!isLoading">
          <div class="item-card" *ngFor="let pet of pets">
            <div class="item-header">
              <h4>{{ pet.name }}</h4>
              <div class="item-actions">
                <span class="species">{{ pet.type }}</span>
                <div class="action-buttons">
                  <button class="edit-btn" (click)="editPet(pet)" title="Düzenle">
                    ✏️
                  </button>
                  <button class="delete-btn" (click)="deletePet(pet.id)" title="Sil">
                    🗑️
                  </button>
                </div>
              </div>
            </div>
            <div class="item-details">
                      <!-- Pet Fotoğrafı -->
        <div class="pet-image" *ngIf="pet.photo">
          <img [src]="pet.photo" [alt]="pet.name + ' fotoğrafı'" class="pet-photo">
        </div>
              
                              <p><strong>Tür:</strong> {{ pet.type }}</p>
              <p><strong>Cins:</strong> {{ pet.breed }}</p>
              <p><strong>Yaş:</strong> {{ pet.age }} yaşında</p>
              <p *ngIf="pet.gender"><strong>Cinsiyet:</strong> {{ pet.gender }}</p>
              <p *ngIf="pet.weight"><strong>Kilo:</strong> {{ pet.weight }} kg</p>
              <p *ngIf="pet.color"><strong>Renk:</strong> {{ pet.color }}</p>
              <p *ngIf="pet.description"><strong>Açıklama:</strong> {{ pet.description }}</p>
            </div>
          </div>
          
          <div class="empty-state" *ngIf="pets.length === 0">
            <p>Henüz pet profili oluşturmadınız.</p>
            <button class="create-btn" (click)="createPetProfile()">
              İlk Pet Profilinizi Oluşturun
            </button>
          </div>
        </div>
      </div>

      <!-- Bakıcı İlanları Bölümü -->
      <div class="section">
        <div class="section-header">
          <h3>🏠 Bakıcı İlanlarım</h3>
          <button class="create-btn" (click)="createSitterProfile()">
            + Yeni İlan
          </button>
        </div>
        
        <div class="items-grid" *ngIf="!isLoading">
          <div class="item-card" *ngFor="let listing of listings">
            <div class="item-header">
              <h4>{{ listing.title || 'Başlıksız İlan' }}</h4>
              <div class="item-actions">
                <span class="price">{{ listing.price }} ₺</span>
                <div class="action-buttons">
                  <button class="edit-btn" (click)="editListing(listing)" title="Düzenle">
                    ✏️
                  </button>
                  <button class="delete-btn" (click)="deleteListing(listing.id)" title="Sil">
                    🗑️
                  </button>
                </div>
              </div>
            </div>
            <div class="item-details">
              <!-- Ev Fotoğrafları -->
              <div class="listing-images" *ngIf="listing.imageUrls && listing.imageUrls.length > 0">
                <div class="image-gallery">
                  <img 
                    *ngFor="let imageUrl of getImageUrls(listing.imageUrls); let i = index" 
                    [src]="imageUrl" 
                    [alt]="(listing.title || 'İlan') + ' fotoğrafı ' + (i + 1)"
                    class="listing-photo"
                    (click)="openImageModal(imageUrl, listing.title || 'İlan')">
                </div>
              </div>
              
              <p><strong>Konum:</strong> {{ listing.location }}</p>
              <p><strong>Fiyat:</strong> {{ listing.price }} ₺</p>
              <p *ngIf="listing.experience"><strong>Deneyim:</strong> {{ listing.experience }} yıl</p>
              <p *ngIf="listing.services && listing.services.trim()"><strong>Hizmetler:</strong> {{ listing.services }}</p>
              <p><strong>Oluşturulma:</strong> {{ listing.createdAt | date:'dd/MM/yyyy HH:mm' }}</p>
              <p><strong>Durum:</strong> 
                <span class="status" [class.active]="listing.isActive">
                  {{ listing.isActive ? 'Aktif' : 'Pasif' }}
                </span>
              </p>
              <p *ngIf="listing.description && listing.description.trim()"><strong>Açıklama:</strong> {{ listing.description }}</p>
            </div>
          </div>
          
          <div class="empty-state" *ngIf="listings.length === 0">
            <p>Henüz bakıcı ilanı oluşturmadınız.</p>
            <button class="create-btn" (click)="createSitterProfile()">
              İlk İlanınızı Oluşturun
            </button>
          </div>
        </div>
      </div>

      <!-- Loading State -->
      <div class="loading-state" *ngIf="isLoading">
        <div class="loading-spinner"></div>
        <p>Veriler yükleniyor...</p>
      </div>

      <!-- Success Message -->
      <div class="success-message" *ngIf="successMessage">
        <div class="success-icon">✅</div>
        <p>{{ successMessage }}</p>
        <button class="close-btn" (click)="onCloseSuccess()">✕</button>
      </div>

      <!-- Error State -->
      <div class="error-state" *ngIf="errorMessage">
        <div class="error-icon">⚠️</div>
        <h3>Bağlantı Hatası</h3>
        <p>{{ errorMessage }}</p>
        <div class="error-actions">
          <button class="retry-btn" (click)="loadUserData()">Tekrar Dene</button>
          <button class="home-btn" (click)="goHome()">Ana Sayfaya Dön</button>
        </div>
      </div>
    </div>

    <!-- Confirm Dialog -->
    <div class="confirm-dialog-overlay" *ngIf="showConfirmDialog" (click)="onConfirmDialogCancel()">
      <div class="confirm-dialog" (click)="$event.stopPropagation()">
        <div class="confirm-dialog-header">
          <h3>{{ confirmDialogData?.title }}</h3>
        </div>
        <div class="confirm-dialog-body">
          <p>{{ confirmDialogData?.message }}</p>
        </div>
        <div class="confirm-dialog-actions">
          <button class="cancel-btn" (click)="onConfirmDialogCancel()">
            {{ confirmDialogData?.cancelText }}
          </button>
          <button class="confirm-btn" (click)="onConfirmDialogConfirm()">
            {{ confirmDialogData?.confirmText }}
          </button>
        </div>
      </div>
    </div>

    <div class="profile-actions">
      <button class="logout-btn" (click)="logout()">
        Çıkış Yap
      </button>
    </div>
  </div>
</div> 