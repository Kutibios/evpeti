<app-header [isLoggedIn]="isLoggedIn" [currentUser]="currentUser"></app-header>

<main>
  <div class="search-container">
    <h1>Evcil Hayvanınız İçin Güvenilir Bakıcı Bulun</h1>
    <p>Deneyimli ve güvenilir bakıcılar ile evcil hayvanınız güvende</p>
    
    <div class="search-and-actions">
      <div class="search-form">
        <div class="search-inputs">
          <div class="input-group">
            <label for="location">Yer</label>
            <input type="text" id="location" placeholder="Şehir seçin">
            <div id="location-dropdown" class="dropdown"></div>
          </div>
          
          <div class="input-group">
            <label for="start-date">Başlangıç Tarihi</label>
            <input type="date" id="start-date">
          </div>
          
          <div class="input-group">
            <label for="end-date">Bitiş Tarihi</label>
            <input type="date" id="end-date">
          </div>
          
          <div class="input-group">
            <label for="pet-type">Hayvan Türü</label>
            <input type="text" id="pet-type" placeholder="Hayvan türü seçin">
            <div id="pet-type-dropdown" class="dropdown"></div>
          </div>
        </div>
        
        <button id="search-button" class="search-button">
          <img src="assets/search.png" alt="Ara">
          Ara
        </button>
      </div>
      
      <div class="action-buttons">
        <button class="create-pet-profile-btn" *ngIf="!isLoggedIn" (click)="showLoginRequired('pet')">
          🐕 Pet Profili Oluştur
        </button>
        <button class="create-sitter-profile-btn" *ngIf="!isLoggedIn" (click)="showLoginRequired('sitter')">
          🏠 Bakıcı Profili Oluştur
        </button>
        <button class="create-pet-profile-btn" *ngIf="isLoggedIn" (click)="createPetProfile()">
          🐕 Pet Profili Oluştur
        </button>
        <button class="create-sitter-profile-btn" *ngIf="isLoggedIn" (click)="createSitterProfile()">
          🏠 Bakıcı Profili Oluştur
        </button>
      </div>
    </div>
  </div>

  <div class="listings-section">
    <h2>Açılan İlanlar</h2>
    
    <div class="filters-container">
      <div class="filter-group">
        <label for="price-filter">Fiyat:</label>
        <select id="price-filter">
          <option value="">Tümü</option>
          <option value="0-50">0-50 TL</option>
          <option value="50-100">50-100 TL</option>
          <option value="100-150">100-150 TL</option>
          <option value="150-200">150-200 TL</option>
          <option value="200-">200+ TL</option>
        </select>
      </div>
      
      <div class="filter-group">
        <label for="pet-filter">Hayvan Türü:</label>
        <select id="pet-filter">
          <option value="">Tümü</option>
          <option value="Köpek">Köpek</option>
          <option value="Kedi">Kedi</option>
          <option value="Kuş">Kuş</option>
          <option value="Diğer">Diğer</option>
        </select>
      </div>
      
      <div class="filter-group">
        <label for="sort-filter">Sırala:</label>
        <select id="sort-filter">
          <option value="newest">En Yeni</option>
          <option value="price-low">Fiyat (Düşük-Yüksek)</option>
          <option value="price-high">Fiyat (Yüksek-Düşük)</option>
          <option value="rating">Puan</option>
        </select>
      </div>
      
      <button class="clear-filters-btn">Filtreleri Temizle</button>
    </div>

    <div class="listings-grid" id="listings-grid">
      <!-- Loading State -->
      <div class="loading-state" *ngIf="isLoading">
        <div class="loading-spinner"></div>
        <p>İlanlar yükleniyor...</p>
      </div>

      <!-- No Listings State -->
      <div class="no-listings" *ngIf="!isLoading && listings.length === 0">
        <p>Henüz ilan bulunmuyor.</p>
      </div>

      <!-- Listings -->
      <div class="listing-card" *ngFor="let listing of listings">
        <!-- Listing Image -->
        <div class="listing-image" *ngIf="listing.imageUrls && getImageUrls(listing.imageUrls).length > 0">
          <img [src]="getImageUrls(listing.imageUrls)[0]" 
               [alt]="listing.title || 'İlan fotoğrafı'"
               class="listing-photo">
        </div>
        <div class="listing-image" *ngIf="!listing.imageUrls || getImageUrls(listing.imageUrls).length === 0">
          {{ getPetEmoji(listing.type) }}
        </div>

        <div class="listing-content">
          <div class="listing-header">
            <div>
              <div class="listing-title">{{ listing.title || 'Başlıksız İlan' }}</div>
              <div class="listing-location">📍 {{ listing.location }}</div>
            </div>
            <div class="listing-price">{{ listing.price }} ₺/gün</div>
          </div>
          <div class="listing-details">
            <div class="listing-detail">🐾 {{ listing.type }}</div>
            <div class="listing-detail" *ngIf="listing.experience">⭐ {{ listing.experience }} yıl</div>
            <div class="listing-detail">📅 {{ listing.createdAt | date:'dd/MM/yyyy' }}</div>
          </div>
          
          <!-- User bilgileri -->
          <div class="listing-user-info" *ngIf="listing.userName">
            <div class="user-avatar">👤</div>
            <div class="user-details">
              <div class="user-name">{{ listing.userName }}</div>
              <div class="user-contact" *ngIf="listing.userEmail">{{ listing.userEmail }}</div>
            </div>
          </div>
          <div class="listing-description">{{ listing.description || 'Açıklama bulunmuyor.' }}</div>
          <div class="listing-footer">
            <div class="listing-rating" *ngIf="listing.experience">⭐ {{ listing.experience }} yıl deneyim</div>
            <div class="listing-date">{{ listing.createdAt | date:'dd/MM/yyyy' }}</div>
          </div>
        </div>
      </div>
    </div>

    <div class="load-more-container" *ngIf="hasMoreListings">
      <button class="load-more-btn" 
              (click)="loadMoreListings()" 
              [disabled]="isLoading">
        <span *ngIf="!isLoading">Daha Fazla Yükle</span>
        <span *ngIf="isLoading" class="loading-text">Yükleniyor...</span>
      </button>
    </div>
  </div>
</main> 